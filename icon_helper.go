//go:build windows

package win32utils

import (
	"fmt"
	"os"
	"path/filepath"
)

// ExtractSystemIcon extracts a system icon and saves it to a temporary file.
// Only works for built-in Windows icons (info, warning, error, success).
// Returns the path to the saved icon file, or empty string if failed.
func ExtractSystemIcon(iconType string) string {
	tempDir := os.TempDir()
	iconFile := filepath.Join(tempDir, fmt.Sprintf("toast_icon_%s.ico", iconType))

	// Icon data for common Windows icons (simple 32x32 ICO format)
	// These are minimal valid ICO files in base64
	var iconData []byte

	switch iconType {
	case "success":
		// Green checkmark (simplified)
		iconData = []byte{
			0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x20, 0x20, 0x00, 0x00, 0x01, 0x00, 0x18, 0x00,
			0x28, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		}
	case "warning":
		// Yellow triangle
		iconData = []byte{
			0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x20, 0x20, 0x00, 0x00, 0x01, 0x00, 0x18, 0x00,
			0x28, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		}
	case "error":
		// Red X
		iconData = []byte{
			0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x20, 0x20, 0x00, 0x00, 0x01, 0x00, 0x18, 0x00,
			0x28, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		}
	case "info":
		// Blue info circle
		iconData = []byte{
			0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x20, 0x20, 0x00, 0x00, 0x01, 0x00, 0x18, 0x00,
			0x28, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		}
	case "question":
		// Question mark
		iconData = []byte{
			0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x20, 0x20, 0x00, 0x00, 0x01, 0x00, 0x18, 0x00,
			0x28, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		}
	default:
		return ""
	}

	// Write to temp file
	if err := os.WriteFile(iconFile, iconData, 0644); err == nil {
		return GetIconPathFromFile(iconFile)
	}

	return ""
}

// SimpleColoredNotification creates a notification with simple colored text to indicate status.
// This doesn't use image icons but uses emoji and styling instead.
func SimpleColoredNotification(appID, status, title, message string) error {
	// Use emoji and text styling instead of icons
	emoji := ""
	switch status {
	case "success":
		emoji = "✓ "
	case "warning":
		emoji = "⚠ "
	case "error":
		emoji = "✗ "
	case "info":
		emoji = "ℹ "
	default:
		emoji = "● "
	}

	return NewAdvancedToastBuilder(appID).
		Title(emoji + title).
		Message(message).
		Duration("long").
		Show()
}
